{% extends '@SkaphandrusAppBundle/Resources/views/content_layout.html.twig' %}

{% block page_title %}{{ category.contest.name }} - {{ category.translate.name }}{% endblock %}
{% block page_description %}description{% endblock %}

{% block heading_title %}
   {{ category.contest.name }} - {{ category.translate.name }}
{% endblock %}

{% block heading_breadcrumbs %}
    <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="{{ path("contests_landing_page") }}">{{ "page.contest.breadcrumb.contest"|trans }}</a></li>
        <li><a href="{{ url_to_contest(category.contest) }}">{{ category.contest.name }}</a></li>
        <li class="active"><strong>{{ category.translate.name }}</strong></li>
    </ol>
{% endblock %}

{% block body %}
<div class="row">
    <div class="col-lg-9">
        <div class="wrapper wrapper-content animated fadeInUp">
            <div class="ibox">
                <div class="ibox-content">
                    <div class="row m-t-sm">
                        <div class="col-lg-12">
                            <div class="panel blank-panel">
                                <div class="panel-heading">
                                    <div class="panel-options">
                                        <ul class="nav nav-tabs">
                                            <li>
                                                <a href="{{ url_to_contest(category.contest) }}">
                                                    {{ "page.contest.tab.get_started"|trans }}
                                                </a>
                                            </li>
                                            <li class="active">
                                                <a href="#tab-1" data-toggle="tab">
                                                    {{ "page.contest.tab.photos"|trans }}
                                                </a>
                                            </li>
                                            <li>
                                                <a href="{{ url_to_contest_photographers(category.contest) }}">
                                                    {{ "page.contest.tab.photographers"|trans }}
                                                </a>
                                            </li>
                                            <li>
                                                <a href="{{ url_to_contest_sponsors(category.contest) }}">
                                                    {{ "page.contest.tab.sponsors"|trans }}
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-content">
                            <div class="file-manager">
                                <h5>{{ "page.contest_photos.h5.categories"|trans }}</h5>
                                <ul class="folder-list" style="padding: 0">
                                    {% for cat in category.contest.categories %}
                                        {% if cat.id == category.id %}
                                            {% set url = '#' %}
                                            {% set class = '-open' %}
                                        {% else %}
                                            {% set url = url_to_contest_photos(cat) %}
                                            {% set class = '' %}
                                        {% endif %}
                                        <li><a href="{{ url }}"><i class="fa fa-folder{{ class }}"></i> {{ cat.translate(app.request.locale).name }}</a></li>
                                    {% endfor %}
                                </ul>
                                <div class="hr-line-dashed"></div>
                                <button class="btn btn-primary btn-block">Upload Files</button>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9 animated fadeInRight">
                    <div class="row">
                        <!--<div class="col-lg-12">-->
                            {% for photo in category.photo %}
                                <div class="file-box">
                                    <div class="file">
                                        {# url_to_photo(photo) causes problems when slug has "/" #}
                                        <a href="{{ url_to_photo(photo) }}" title="{{ photo.title }}">
                                            <span class="corner"></span>

                                            <div class="image">
                                                {# <img alt="image" class="img-responsive" src="{{ photo.webPath|imagine_filter('sk_thumbnail_outbound_198_100') }}">#}
                                                <img alt="image" class="img-responsive" src="{{ "uploads/11138585_1606358319621583_5687423293522990896_n.jpg"|imagine_filter('sk_thumbnail_outbound_198_100') }}">
                                            </div>
                                            <div class="file-name">
                                                {{ photo.title|truncate(20) }}<br/>
                                                <small>Added: {{ photo.createdAt|date }}</small>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        <!--</div>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3">
        <div class="wrapper wrapper-content project-manager hidden-sm hidden-xs hidden-md" data-spy="affix" data-offset-top="112" style="top: 0; max-width: 250px;">
            <h2>{{ category.contest.name }}</h2>
            <!--<img src="{{ category.contest.logo }}" class="img-responsive">-->
            <img src="/uploads/11138585_1606358319621583_5687423293522990896_n.jpg" class="img-responsive">
            <p class="small">
                {{ category.contest.translate.description|raw }}
            </p>
            {# Calculate the project completeness #}
            {% if "now"|date("U") < category.contest.beginAt|date("U") %}
                {% set percentage = 0 %}
                {% set contest_status = 'not-started' %}
            {% elseif "now"|date("U") < category.contest.endAt|date("U") %}
                {% set time_length = category.contest.endAt|date("U") - category.contest.beginAt|date("U") %}
                {% set current_time_length = "now"|date("U") - category.contest.beginAt|date("U") %}
                {% set percentage = ( (current_time_length * 100) / time_length )|number_format %}
                {% set contest_status = 'active' %}
            {% else %}
                {% set percentage = 100 %}
                {% set contest_status = 'completed' %}
            {% endif %}
            <p><strong>{{ "page.contest.dt.status"|trans }}:</strong> <span class="label label-primary">{{ "page.contest.label.status_" ~ contest_status|trans }}</span></p>
            <p><strong>{{ "page.contest.label.created_by"|trans }}:</strong> Alex Smith</p>
            <p><strong>{{ "page.contest.label.client"|trans }}:</strong> <a href="#" class="text-navy"> Skaphandrus</a></p>
            <p><strong>{{ "page.contest.label.created"|trans }}:</strong> {{ category.contest.createdAt|date }}</p>
            <p><strong>{{ "page.contest.label.starts_at"|trans }}:</strong> {{ category.contest.beginAt|date }}</p>
            <p><strong>{{ "page.contest.label.ends_at"|trans }}:</strong> {{ category.contest.endAt|date }}</p>
        </div>
    </div>
</div>

{% endblock %}

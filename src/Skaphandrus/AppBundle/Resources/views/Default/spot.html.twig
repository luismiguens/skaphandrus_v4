{% extends '@SkaphandrusAppBundle/Resources/views/content_layout.html.twig' %}

{% block page_title %}{% trans with {'%spot%': spot.name, '%location%': spot.location.name, '%country%': spot.location.region.country} %}page.spot.meta_tag.title{% endtrans %}{% endblock %}

{% block page_description %}{{spot.description [0:160]}}{% endblock %}

{% block hreflang %}
    <link rel="alternate" hreflang="pt" href="{{ app.request.getSchemeAndHttpHost() ~ path('spot', {'country':slugify(spot.location.region.country.getCountryName('pt')), 'location':slugify(spot.location.translate('pt').name), 'slug':slugify(spot.translate('pt').name), 'locale': 'pt'}) }} " />
    <link rel="alternate" hreflang="en" href="{{ app.request.getSchemeAndHttpHost() ~ path('spot', {'country':slugify(spot.location.region.country.getCountryName('en')), 'location':slugify(spot.location.translate('en').name), 'slug':slugify(spot.translate('en').name), 'locale': 'en'}) }}" />
{% endblock %}


{% set keywords = spot.name %}
{% set keywords = keywords~', '~spot.location.name %}
{% set keywords = keywords~', '~spot.location.region.country %}
{% set keywords = keywords~', '~("meta_tag.keyword.map"|trans) %}
{% set keywords = keywords~', '~("meta_tag.keyword.scuba"|trans) %}
{% set keywords = keywords~', '~("meta_tag.keyword.diving"|trans) %}
{% set keywords = keywords~', '~("meta_tag.keyword.dive"|trans) %}
{% set keywords = keywords~', '~("meta_tag.keyword.sites"|trans) %}
{% set keywords = keywords~', '~("meta_tag.keyword.locations"|trans) %}
{% set keywords = keywords~', '~("meta_tag.keyword.animals"|trans) %}
{% set keywords = keywords~', '~("meta_tag.keyword.species"|trans) %}
{% set keywords = keywords~', '~("meta_tag.keyword.images"|trans) %}
{% set keywords = keywords~', '~("meta_tag.keyword.photos"|trans) %}
{% set keywords = keywords~', '~("meta_tag.keyword.pictures"|trans) %}
{% set keywords = keywords~', '~("meta_tag.keyword.depth"|trans) %}
{% set keywords = keywords~', '~("meta_tag.keyword.coordinate"|trans) %}

{% block page_keywords %}{{keywords}}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('bundles/skaphandrusapp/css/plugins/blueimp/css/blueimp-gallery.min.css') }}">
    {#<!-- FooTable -->
    <link href="{{ asset('bundles/skaphandrusapp/css/plugins/footable/footable.core.css') }}" rel="stylesheet">#}

    <style type="text/css">
        {#.ibox-title {
            margin-top: 1.7%;
        }#}
        .ibox-title p {
            margin-left: 1%;
        }
        .ibox-content p {
            text-align: justify;
            text-indent: 10px;
        }
        .in.collapse+a.btn.showdetails:before {
            content: "{{"common.hide"|trans}}";
        }
        .collapse+a.btn.showdetails:before {
            content:"{{"common.show_more"|trans}}";
        }
        .roller {
            width: 85%;
            margin-left:3%;
        }
        .roller img {
            min-width: 100px;
            min-height: 100px;
        }
        .roller button {
            width: 100px;
            height: 100px;
            margin-top: 5%;

        }
        .label {
            border-radius: 10px;
        }
        .thumbnail {
            border: 1px solid #FFF;
            margin-bottom: 0%;
        }
        a.thumbnail.active, a.thumbnail:focus, a.thumbnail:hover{
            border-color: #1AB394;
        }
        .slick-slider {
            margin-bottom: 0px;
        }
        .img-circle{
            width: 38px;
            height: 38px;
        }
        .tabs-container{
            margin-bottom: 2%;
        }
        .logo{
            width: 100px;
            min-height: 100px;
            max-height: 300px;
            padding-top: 5%;
            padding-bottom: 5%;
        }
        .logo2{
            width: 100px;
            min-height: 100px;
            max-height: 300px;
        }
        .col-lg-6 h6 {
            margin-top: 0px;
            padding-left: 10%;
        }
        .col-lg-6 p {
            margin-bottom: 0px;
            padding-left: 0%;
        }
        .tab-content h6 {
            text-indent: 10px;
        }

    </style>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/skaphandrusapp/js/plugins/blueimp/jquery.blueimp-gallery.min.js') }}"></script>

    <!-- FooTable -->
    {#    <script src="{{ asset('bundles/skaphandrusapp/js/plugins/footable/footable.all.min.js') }}"></script>#}

    <!-- Slick JQuery -->
    <script type="text/javascript" src="//cdn.jsdelivr.net/jquery.slick/1.5.9/slick.min.js"></script>

    <script type="text/javascript">

        $('.row .btn').on('click', function (e) {
            e.preventDefault();
            var $this = $(this);
            var $collapse = $this.closest('.collapse-group').find('.collapse');
            $collapse.collapse('toggle');
        });

        $(function () {
            var limit_species = 3;
            var offset_species = -3;
            var limit_photographers = 3;
            var offset_photographers = -3;

            var loadSpecies = function () {
                $('#box_species').fadeIn("slow");
                offset_species = offset_species + 3;
                setTimeout(function () {
                    $.ajax({
                        type: "get",
                        url: "{{path("ajax_species_show_more")}}",
                        data: 'spot_id=' + {{ spot.id }} +'&limit=' + limit_species + '&offset=' + offset_species,
                        dataType: "text",
                        success: function (response) {
                            $("#box_species").append(response);
                        }
                    });
                }, 100);
            };
            $(this).ready(loadSpecies);
            $('#show_more_species').click(loadSpecies);

            var loadPhotographers = function () {
                $('#box_photographers').fadeIn("slow");
                offset_photographers = offset_photographers + 3;
                setTimeout(function () {
                    $.ajax({
                        type: "get",
                        url: "{{path("ajax_photographers_show_more")}}",
                        data: 'spot_id=' + {{ spot.id }} +'&limit=' + limit_photographers + '&offset=' + offset_photographers,
                        dataType: "text",
                        success: function (response) {
                            $("#box_photographers").append(response);
                        }
                    });
                }, 100);
            };
            $(this).ready(loadPhotographers);
            $('#show_more_photographers').click(loadPhotographers);

        });

        var spotId = 'spot_id= {{ spot.id }}';

        var loadSpeciesAll = function () {
            setTimeout(function () {
                $.ajax({
                    type: "get",
                    url: "{{path("ajax_species_see_all")}}",
                    data: spotId,
                    dataType: "text",
                    success: function (response) {
                        $("#speciesInput").html(response);
                    }
                });
            }, 100);
        };
        $(this).ready(loadSpeciesAll);
        $('#speciesModal').on('shown.bs.modal', loadSpeciesAll);

        var loadPhotographersAll = function () {
            setTimeout(function () {
                $.ajax({
                    type: "get",
                    url: "{{path("ajax_photographers_see_all")}}",
                    data: spotId,
                    dataType: "text",
                    success: function (response) {
                        $("#photographersInput").html(response);
                    }
                });
            }, 100);
        };
        $(this).ready(loadPhotographersAll);
        $('#photographersModal').on('shown.bs.modal', loadPhotographersAll);

        {#$(document).ready(function () {
            $('.footable-species').footable();
            $('.footable-photographers').footable();
        });#}

    </script>

    {% if map %}
        <script>
            // Fix bug on Gmap inside tabs
            $('.nav-tabs').on('shown.bs.tab', function () {
                google.maps.event.trigger(window, 'resize', {});
                setTimeout(function () {
            {{ map.javascriptVariable }}.setCenter({{ map.center.javascriptVariable }});
                    }, 100);
                });
        </script>
    {% endif %}

{% endblock %}

{% block heading_title %}
    {% trans with {'%spot%': spot.name, '%location%': spot.location.name, '%country%': spot.location.region.country} %}page.spot.h1.heading_title{% endtrans %}
{% endblock %}


{% block heading_breadcrumbs %}
    <ol class="breadcrumb" itemprop="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
        <li itemprop="itemListElement"><a href="{{ path('index') }}">{{ "breadcrumb.home"|trans }}</a></li>
        <li itemprop="itemListElement"><a href="{{ path('locations_home') }}">{{ "breadcrumb.locations"|trans }}</a></li>
        <li itemprop="itemListElement">{{ link_to_country(spot.location.region.country) }}</li>
        <li itemprop="itemListElement">{{ link_to_location(spot.location) }}</li>
        <li itemprop="itemListElement" class="active"><strong>{{ spot.name }}</strong></li>
    </ol>
{% endblock %}


{% block heading_action %}
    <a href="{{ path('photo_admin_new') }}" class="btn btn-primary">{{ "form.photo.btn.add"|trans }}</a>
{% endblock %}


{% block body %}

    <div class="wrapper wrapper-content" itemscope itemtype="http://schema.org/TouristAttraction">
        <div class="animated fadeInRight"> 

            <div class="row" >
                <div class="col col-lg-12" >
                    <div class="ibox-title" >
                        <meta itemprop="isicV4" content="96590" />
                        <h1 itemprop="name">{% trans with {'%spot%': spot.name, '%location%': spot.location.name, '%country%': spot.location.region.country} %}page.spot.h1.title{% endtrans %}</h1>
                    </div>
                    <div class="ibox-content" >

                        <h3>{% trans with {'%spot%': spot.name, '%location%': spot.location.name, '%country%': spot.location.region.country} %}page.spot.h3.info{% endtrans %}</h3>
                        <span itemprop="geo" itemscope itemtype="http://schema.org/GeoCoordinates">
                            {% set coordinate = spot.coordinate|split(',') %}
                            <meta itemprop="latitude" content="{{coordinate[0]}}" />
                            <meta itemprop="longitude" content="{{coordinate[1]}}" />
                        </span>
                        {% if spot.description is not empty %}
                            <p itemprop="description">{{ spot.description|raw }}</p>
                        {% else %}
                            {{ "page.spot.p.no_description"|trans }}
                        {% endif %}
                    </div>
                </div>
            </div>

            <!--  Mapa de spots start -->
            <div class="row" style ="margin-top: 2%" >
                <div class="col col-lg-12">
                    <div class="ibox-title" >
                        <h3>{% trans with {'%spot%': spot.name, '%location%': spot.location.name, '%country%': spot.location.region.country} %}page.spot.h3.spot{% endtrans %}</h3>
                    </div>
                    <div class="row" >
                        <div class="col col-lg-12" >
                            <div class="ibox" >

                                {% if map %}
                                    {{ google_map(map) }}
                                {% endif %}

                                <div class="ibox-content">
                                    <div class="row">
                                        <div class="col col-lg-2  col-xs-2 col-md-4 ">
                                            <strong> <h4>{{ spot }}</h4> </strong>
                                            <p>{{"common.spot.number_photos"|trans}}: <span class="label label-info">{{spot.photosInSpot}}</span>  </p>
                                        </div>
                                        <div class="col col-lg-10 col-xs-10 col-md-8">
                                            <div class="roller slick-initialized slick-slider">
                                                <div class="slick-list draggable">
                                                    <div style="opacity: 1; width: 800px; left: 0px;" class="slick-track">
                                                        {% if spot.photosInSpot > 6 %}
                                                            {% for photo in spot.photos %}
                                                                <div style="width: 112px;" class="slick-slide slick-current slick-active">
                                                                    <a class="thumbnail" href="{{ path('photo_no_slug',  { 'id': photo.id }) }}" title="{{ photo.title }}">
                                                                        <img style="width: 100px; margin:1% 2px 0px 2px;" itemprop="image" alt="{{ photo.title }}" src="{{ photo.getWebPath | imagine_filter('sk_thumbnail_outbound_100') }}" />
                                                                    </a>
                                                                </div>
                                                            {% endfor %}
                                                            <div style="width: 112px;" class="slick-slide slick-active">
                                                                <button onclick="location.href = '{{ path('photos', { 'spot': spot.id }) }}'" style="margin-left: 3%;" type="button" class="btn btn-block btn-outline btn-primary">
                                                                    {{ "common.grid.see_all"|trans }}
                                                                </button>
                                                            </div>
                                                        {% elseif spot.photosInSpot > 0 and spot.photosInSpot <= 6  %}
                                                            {% for photo in spot.photos %}
                                                                <div style="width: 112px;" class="slick-slide slick-current slick-active">
                                                                    <a class="thumbnail" href="{{ path('photo_no_slug',  { 'id': photo.id }) }}" title="{{ photo.title }}">
                                                                        <img style="width: 100px; margin:1% 2px 0px 2px;" itemprop="image" alt="{{ photo.title }}" src="{{ photo.getWebPath | imagine_filter('sk_thumbnail_outbound_100') }}" />
                                                                    </a>
                                                                </div>
                                                            {% endfor %}
                                                            <div style="width: 112px;" class="slick-slide slick-active">
                                                                <button onclick="location.href = '{{ path('photo_admin_new') }}';" style="margin-left: 3%;" type="button" class="btn btn-block btn-primary">
                                                                    {{ "common.grid.add_photo"|trans }}
                                                                </button>
                                                            </div>
                                                        {% else %}
                                                            <div style="width: 330px; margin-top: 45px" class="slick-slide slick-current slick-active">
                                                                {{"common.spot.no_photos"|trans}}
                                                            </div>
                                                            <div style="width: 112px;" class="slick-slide slick-active">
                                                                <button onclick="location.href = '{{ path('photo_admin_new') }}';" style="margin-left: 3%;" type="button" class="btn btn-primary">
                                                                    {{ "common.grid.add_photo"|trans }}
                                                                </button>
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {#<div class="ibox-content" >
                                    <div class="row" >
                                        <div class="col col-lg-12" >
                                            <button id="show_more_spots" type="button" class="btn btn-block btn-outline btn-primary">{{ "page.location.button.show_more_spots"|trans }}</button>
                                        </div>
                                    </div>
                                </div>#}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--  Mapa de spots end -->

            <!--  Species start -->
            <div class="row" >
                <div class="col col-lg-12">
                    <div class="ibox-title" >
                        <h3>{% trans with {'%spot%': spot.name, '%location%': spot.location.name, '%country%': spot.location.region.country} %}page.spot.h3.species{% endtrans %}</h3>
                    </div>
                    <div class="row" >
                        <div class="col col-lg-12" >
                            <div class="ibox" >

                                <div id="box_species"></div>

                                <!-- Species Modal start -->
                                <div class="modal fade" id="speciesModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                                    <div class="modal-dialog modal-lg" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                <h4 class="modal-title" id="myModalLabel">{% trans with {'%spot%': spot.name, '%location%': spot.location.name, '%country%': spot.location.region.country} %}page.spot.h4.species_modal{% endtrans %}</h4>
                                            </div>
                                            <div class="modal-body">

                                                <div id="speciesInput"></div>

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Species Modal end -->

                                <div class="ibox-content" >
                                    <div class="row" >
                                        <div class="col col-lg-12" >
                                            <button style="width: 49%;" type="button" class="btn btn-outline btn-primary" id="show_more_species">{{ "page.location.button.show_more_species"|trans }}</button>
                                            <button style="width: 49%;" type="button" class="btn btn-outline btn-default" data-toggle="modal" data-target="#speciesModal">{{ "page.location.button.see_all_species"|trans }}</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--  Species end -->

            <!--  Photographers start -->
            <div class="row" >
                <div class="col col-lg-12">
                    <div class="ibox-title" >
                        <h3>{% trans with {'%spot%': spot.name, '%location%': spot.location.name, '%country%': spot.location.region.country} %}page.spot.h3.contributors{% endtrans %}</h3>
                    </div>
                    <div class="row" >
                        <div class="col col-lg-12" >
                            <div class="ibox" >

                                <div id="box_photographers"></div>

                                <!-- Photographers Modal start -->
                                <div class="modal fade" id="photographersModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                                    <div class="modal-dialog modal-lg" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                                <h4 class="modal-title" id="myModalLabel">{% trans with {'%spot%': spot.name, '%location%': spot.location.name, '%country%': spot.location.region.country} %}page.spot.h4.photographers_modal{% endtrans %}</h4>
                                            </div>
                                            <div class="modal-body">

                                                <div id="photographersInput"></div>

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Photographers Modal end -->

                                <div class="ibox-content" >
                                    <div class="row" >
                                        <div class="col col-lg-12" >
                                            <button style="width: 49%;" type="button" class="btn btn-outline btn-primary" id="show_more_photographers" >{{ "page.location.button.show_more_photographers"|trans }}</button>
                                            <button style="width: 49%;" type="button" class="btn btn-outline btn-default" data-toggle="modal" data-target="#photographersModal">{{ "page.location.button.see_all_photographers"|trans }}</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--  Photographers end -->

            <!--  Dive Centers start -->
            <div class="tabs-container">
                <ul class="nav nav-tabs">
                    <li class="active"><a aria-expanded="true" data-toggle="tab" href="#tab-1">{{ "page.spot.tab1.dive_centers"|trans }}</a></li>
                    <li class=""><a aria-expanded="false" data-toggle="tab" href="#tab-2">{{ "page.spot.tab2.liveaboard"|trans }}</a></li>
                    <li class=""><a aria-expanded="false" data-toggle="tab" href="#tab-3">{{ "page.spot.tab3.resorts"|trans }}</a></li>
                </ul>
                <div class="tab-content">
                    <div id="tab-1" class="tab-pane active">
                        <div class="panel-body">
                            <h4>{{ "page.spot.h4.dive_center"|trans }}</h4>
                            <div class="row" >
                                {% if diveCenters %}
                                    {% for b in diveCenters %}
                                        <div class="col col-lg-4" style="margin-bottom: 1%" >
                                            <div class="ibox" >
                                                <div class="col col-lg-5" >
                                                    {% if b.getWebPath %}
                                                        <a href="{{ path('business', { 'country': slugify((b.address.location.region.country)), 'location': slugify(b.address.location), 'slug': slugify(b.name) }) }}">
                                                            <img class="logo" src="{{ b.getWebPath | imagine_filter('sk_widen_100') }}"/>
                                                        </a>
                                                    {% else %}
                                                        <a href="">
                                                            <img class="logo" src="{{ asset('/uploads/business/blank-logo.png') }}"/>
                                                        </a>
                                                    {% endif %}
                                                </div>
                                                <div class="col col-lg-7" >
                                                    <a href="{{ path('business', { 'country': slugify((b.address.location.region.country)), 'location': slugify(b.address.location), 'slug': slugify(b.name) }) }}">
                                                        <h4>{{b|slice(0, 21)}}</h4>
                                                    </a>
                                                    <h5>{{ b.address.location }}</h5>

                                                    <button class="btn btn-primary dim" type="button" onclick="location.href = '{{ path('booking_admin_new', {'business_id': b.id}) }}'">{{ "page.business.button.book_now"|trans }}</button>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="col col-lg-12">
                                        {{ "page.spot.h4.no_dive_center"|trans }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div id="tab-2" class="tab-pane">
                        <div class="panel-body">
                            <h4>{{ "page.spot.h4.liveaboard"|trans }}</h4>
                            <div class="row" >
                                {% if liveaboards %}
                                    {% for b in liveaboards %}
                                        <div class="col col-lg-4" style="margin-bottom: 1%" >
                                            <div class="ibox" >
                                                <div class="col col-lg-5" >
                                                    {% if b.getWebPath %}
                                                        <a href="{{ path('business', { 'country': slugify((b.address.location.region.country)), 'location': slugify(b.address.location), 'slug': slugify(b.name) }) }}">
                                                            <img class="logo" src="{{ b.getWebPath | imagine_filter('sk_widen_100') }}"/>
                                                        </a>
                                                    {% else %}
                                                        <a href="">
                                                            <img class="logo" src="{{ asset('/uploads/business/blank-logo.png') }}"/>
                                                        </a>
                                                    {% endif %}
                                                </div>
                                                <div class="col col-lg-7" >
                                                    <a href="{{ path('business', { 'country': slugify((b.address.location.region.country)), 'location': slugify(b.address.location), 'slug': slugify(b.name) }) }}">
                                                        <h4>{{b|slice(0, 21)}}</h4>
                                                    </a>
                                                    <h5>{{ b.address.location }}</h5>

                                                    <button class="btn btn-primary dim" type="button" onclick="location.href = '{{ path('booking_admin_new', {'business_id': b.id}) }}'">{{ "page.business.button.book_now"|trans }}</button>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="col col-lg-12">
                                        {{ "page.spot.h4.no_liveaboard"|trans }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div id="tab-3" class="tab-pane">
                        <div class="panel-body">
                            <h4>{{ "page.spot.h4.accommodation"|trans }}</h4>
                            <div class="row" >
                                {% if accommodations %}
                                    {% for b in accommodations %}
                                        <div class="col col-lg-4" style="margin-bottom: 1%" >
                                            <div class="ibox" >
                                                <div class="col col-lg-5" >
                                                    {% if b.getWebPath %}
                                                        <a href="{{ path('business', { 'country': slugify((b.address.location.region.country)), 'location': slugify(b.address.location), 'slug': slugify(b.name) }) }}">
                                                            <img class="logo" src="{{ b.getWebPath | imagine_filter('sk_widen_100') }}"/>
                                                        </a>
                                                    {% else %}
                                                        <a href="">
                                                            <img class="logo" src="{{ asset('/uploads/business/blank-logo.png') }}"/>
                                                        </a>
                                                    {% endif %}
                                                </div>
                                                <div class="col col-lg-7" >
                                                    <a href="{{ path('business', { 'country': slugify((b.address.location.region.country)), 'location': slugify(b.address.location), 'slug': slugify(b.name) }) }}">
                                                        <h4>{{b|slice(0, 21)}}</h4>
                                                    </a>
                                                    <h5>{{ b.address.location }}</h5>

                                                    <button class="btn btn-primary dim" type="button" onclick="location.href = '{{ path('booking_admin_new', {'business_id': b.id}) }}'">{{ "page.business.button.book_now"|trans }}</button>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="col col-lg-12">
                                        {{ "page.spot.h4.no_accommodation"|trans }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--  Dive Centers end -->
        </div>
    </div>

{% endblock %}



